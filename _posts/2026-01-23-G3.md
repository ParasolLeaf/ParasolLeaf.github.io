---
title: 论文阅读《G3 An Effective and Adaptive Framework for Worldwide Geolocalization Using Large Multi-Modality Models》
date: 2026-01-23 22:20:00 +0800
categories: [论文阅读, Geo-localization]
tags: [论文阅读, Geo-localization, 多模态]
author: wyt
math: true
---

> 本次阅读的论文是《G3:利用大型多模态模型进行全球地理定位的有效自适应框架》，其收录于NeurIPS 2024。

# 已有工作
目前针对图寻工作主要可分为三类：
- 基于分类的方法: 将全球地理空间划分为若干固定区域，训练模型将输入的图像归类到某个区域中，并将该区域的众信作为预测值。但是有可能出现划分的每个区域范围过大，即使区域命中了，但是区域中心点和实际点差异较大。
- 基于检索的方法：维护一个图像数据库，将图像定位转换为图像 $\rightarrow$ 图像，或图像 $\rightarrow$ GPS坐标的检索问题，最终预测是通过在给定候选数据库中检索符合要求的GPS。但是对于全球范围内维护这样一个数据库时不现实的。
- 检索增强生成RAG方法：通过RAG，利用多模态大模型的推理泛化能力，将检索到的GPS坐标嵌入到prompt中作为参考后，再让大模型进行最终的预测。目前的方法（2024年以前），无法准确提取视觉信息（因为只是计算了visual embedding的相似度）帮助推测图像的位置。

# 存在的问题
1. 难以提取能准确显示图像地理位置的视觉语义
    两个相隔距离很大的地方也有可能具有相似的视觉特征，传统视觉特征无法有效说明位置。
2. 图像本身在地理分布上呈现异质性
    对于检索方法，只有当数据库中对于目标点位周围的已有存储数据较多时表现良好，但是对于存储点位较少的地区效果大打折扣。而这会影响到后续的RAG方法，生成过程缺乏鲁棒性，导致无法适应全球不同点位图像的查询。

# 本篇文章core idea
- 在检索阶段：进行geo-alignment，将GPS坐标、图像、文本描述三者进行对齐，使位置信息与视觉信息对应，为此在MP-16数据集上增广了地理描述的文本，建立了MP16-pro数据集。
- 在生成阶段：建立了一套更为复杂的prompt，其可以针对不同类型的图像采用不同对应的prompt进行嵌入query，得到一个预测的GPS。
- 验证：将预测的GPS和检索阶段的encoder得到的GPS、图像、描述作相似性比对，选出和预测GPS最相似的GPS作为最终结果。


# 方法细节
![image.png](/assets/img/G3/G3_framework.jpg)
G3整体框架可以概括为三步（对应G3的名字）：Geo-alignment、Geo-diversification、Geo-verification。其总体流程如论文 Figure 2 所示，分为数据库构建阶段与预测阶段两部分。:contentReference[oaicite:0]{index=0}

## A.Geo-alignment：对齐 Image / GPS / Text，获得“位置感”视觉特征
### 为什么要做 Geo-alignment？
传统方法在检索阶段通常直接用CLIP/ResNet等视觉特征做相似度搜索，但视觉相似并不等价于地理相近：相隔很远的两个地点可能具有相似的视觉外观（例如海岸、森林、雪地等），导致检索到的参考GPS对后续生成阶段产生误导。因此，G3希望让检索阶段的embedding不仅“看起来像”，还要“地理上近”。

### Image encoding
G3使用预训练视觉编码器（CLIP ViT-L/14），并接入两个可训练投影层，让图像分别对齐到文本空间和GPS空间：
$$ 
   e^{image}_{i,text}=f_{text}(V(I_i)), \quad
   e^{image}_{i,gps}=f_{gps}(V(I_i))
$$
  
其中 $V(\cdot)$ 是冻结的视觉编码器，$ f_{text}, f_{gps} $ 是可训练的FFN层。

### GPS encoding：Mercator投影 + Random Fourier Features
为了将经纬度映射到更适合学习的空间，G3没有采用之前工作常用的Equal Earth Projection（EEP），而是采用 **Mercator Projection**（保角性质更适合经纬度变化趋势建模）。
Mercator投影公式：$x = R(\lambda-\lambda_0),\quad y = R\ln\left(\tan(\frac{\pi}{4}+\frac{\phi}{2})\right)$
随后对投影后的坐标引入 **RFF（Random Fourier Features）**，并用多层不同频率（多层 $\sigma$）叠加以捕获多尺度的地理模式。

### Text encoding：反向地理编码生成地理描述
G3通过反向地理编码将GPS转成文本描述（如“某州/某国”），再输入CLIP text encoder得到文本embedding。这一步的意义在于：文本描述能补充离散地理信息（国家/城市边界变化明显），与连续地理信息（气候/植被随经纬度变化）形成互补。

### 对齐目标：跨模态对比学习
Geo-alignment通过对比学习将 image-text、image-gps 对齐，损失函数形式为：$L_{a,b}=-\sum_{i=1}^{n}\log\frac{\exp(logits_{ii})}{\sum_{j=1}^{n}\exp(logits_{ij})}$

最终目标为同时对齐多个方向：$L = (L_{image,text}+L_{image,gps}+L_{text,image}+L_{gps,image})/2$

### 数据库向量构建：拼接增强特征
训练完成后，G3将图像向量存入数据库。为了保留原始视觉语义 + 地理对齐语义，最终向量采用拼接：

$$ e' = concat(e^{image}, e^{image}_{text}, e^{image}_{gps}) $$


## B.Geo-diversification：Prompt Ensemble提升生成阶段鲁棒性

### 动机：不同图像需要不同数量的参考坐标
由于全球图像分布异质性很强，不同query的检索质量差异巨大。若固定使用同样数量的reference GPS，会导致：
- 有些图像reference太少信息不足
- 有些图像reference太多反而引入噪声

因此G3提出Geo-diversification：构造多个RAG prompt，分别使用不同数量的reference坐标（包括0 reference的zero-shot），并生成多个候选GPS。候选生成可表示为：$\{c^k_1,c^k_2,...,c^k_n\}=RAG(p_k)$
最终候选池由“检索得到的候选GPS”与“多prompt生成的候选GPS”共同组成。


## C.Geo-verification：在候选池中选最可信GPS
Geo-diversification会生成较多候选，但其中存在噪声，因此需要一个验证机制选出最终结果。G3复用Geo-alignment阶段训练出的Image-to-GPS表示空间，对每个候选GPS计算与query image的相似度：$sim = e^{image}_{gps}(e^{gps})^T$
最终输出相似度最高的候选坐标：$j = \arg\max(sim_j)$

# 实验结果
![image.png](/assets/img/G3/G3_results.jpg)

# Reference
- Pengyue Jia et al., **G3: An Effective and Adaptive Framework for Worldwide Geolocalization Using Large Multi-Modality Models**, NeurIPS 2024.